{%- doc -%}
  Wishlist button block — adds product to a localStorage-based wishlist.
  Shows heart icon. Toggles active state. Works without any app.
{%- enddoc -%}

{% liquid
  assign product = closest.product
  if request.visual_preview_mode and product == blank
    assign product = collections.all.products.first
  endif
%}

<div
  class="wishlist-block spacing-style"
  style="{% render 'spacing-style', settings: block.settings %}"
  {{ block.shopify_attributes }}
>
  <button
    class="wishlist-block__btn"
    data-wishlist-pid="{{ product.id }}"
    aria-label="{{ 'actions.add_to_wishlist' | t | default: 'Add to Wishlist' }}"
    type="button"
  >
    <span class="wishlist-block__icon" aria-hidden="true">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
      </svg>
    </span>
    <span class="wishlist-block__text wishlist-block__text--add">
      {{ block.settings.add_text | default: 'Add to Wishlist' }}
    </span>
    <span class="wishlist-block__text wishlist-block__text--remove">
      {{ block.settings.remove_text | default: 'Remove from Wishlist' }}
    </span>
  </button>
</div>

<script>
(function() {
  var pid = '{{ product.id }}';

  function getWL() {
    try { return JSON.parse(localStorage.getItem('ba_wishlist') || '[]'); } catch(e) { return []; }
  }
  function saveWL(list) {
    try { localStorage.setItem('ba_wishlist', JSON.stringify(list)); } catch(e) {}
  }

  function initWishlistBtn(btn) {
    if (!btn) return;
    var list = getWL();
    if (list.indexOf(pid) > -1) btn.classList.add('active');

    btn.addEventListener('click', function() {
      var list = getWL();
      var idx  = list.indexOf(pid);
      if (idx > -1) {
        list.splice(idx, 1);
        btn.classList.remove('active');
      } else {
        list.push(pid);
        btn.classList.add('active');
      }
      saveWL(list);
      // Animate
      btn.classList.add('wishlist-block__btn--pop');
      setTimeout(function() { btn.classList.remove('wishlist-block__btn--pop'); }, 400);
    });
  }

  document.querySelectorAll('[data-wishlist-pid="{{ product.id }}"]').forEach(initWishlistBtn);
})();
</script>

{% stylesheet %}
  .wishlist-block {
    width: 100%;
    display: block;
    /* Force full-width row — prevents it collapsing into flex row with buy buttons */
    flex: 1 0 100% !important;
    min-width: 100% !important;
    box-sizing: border-box;
  }

  /* ── Button — same style as screenshot: white bg + blue outline ── */
  .wishlist-block__btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    width: 100%;
    height: 50px;
    padding: 0 16px;
    background: #ffffff;
    color: #4a90d9;
    font-size: 13px;
    font-weight: 800;
    letter-spacing: 0.6px;
    text-transform: uppercase;
    border: 2px solid #4a90d9;
    border-radius: 5px;
    cursor: pointer;
    transition: background 0.15s ease, color 0.15s ease, transform 0.1s ease, border-color 0.15s ease;
    font-family: var(--font-body--family);
  }

  .wishlist-block__btn:hover {
    background: #4a90d9;
    color: #ffffff;
    transform: translateY(-1px);
  }

  .wishlist-block__btn:hover .wishlist-block__icon svg {
    stroke: #ffffff;
  }

  /* Active / wishlisted state */
  .wishlist-block__btn.active {
    background: #fff0f0;
    border-color: #e04040;
    color: #e04040;
  }

  .wishlist-block__btn.active .wishlist-block__icon svg {
    stroke: #e04040;
    fill: #e04040;
  }

  .wishlist-block__btn.active .wishlist-block__text--add { display: none; }
  .wishlist-block__btn:not(.active) .wishlist-block__text--remove { display: none; }

  /* Pop animation */
  @keyframes wishlist-pop {
    0%   { transform: scale(1); }
    40%  { transform: scale(1.12); }
    100% { transform: scale(1); }
  }

  .wishlist-block__btn--pop .wishlist-block__icon {
    animation: wishlist-pop 0.4s ease;
  }

  .wishlist-block__icon {
    display: flex;
    align-items: center;
    flex-shrink: 0;
  }

  .wishlist-block__icon svg {
    width: 20px;
    height: 20px;
    stroke: currentColor;
    transition: fill 0.15s ease, stroke 0.15s ease;
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Wishlist Button",
  "tag": null,
  "settings": [
    {
      "type": "text",
      "id": "add_text",
      "label": "Add to Wishlist text",
      "default": "Add to Wishlist"
    },
    {
      "type": "text",
      "id": "remove_text",
      "label": "Remove from Wishlist text",
      "default": "Remove from Wishlist"
    },
    {
      "type": "header",
      "content": "Padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "Top",
      "min": 0,
      "max": 60,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "Bottom",
      "min": 0,
      "max": 60,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-inline-start",
      "label": "Left",
      "min": 0,
      "max": 60,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-inline-end",
      "label": "Right",
      "min": 0,
      "max": 60,
      "step": 1,
      "unit": "px",
      "default": 0
    }
  ]
}
{% endschema %}
