{% doc %}
  Cart Products

  Renders the cart products list or empty cart state.

  @param {boolean} [force_empty] - Force render empty cart state

  @example
  {% render 'cart-products', force_empty: true %}
{% enddoc %}

{% liquid
  assign block_settings = block.settings
%}

<script
  src="{{ 'component-cart-items.js' | asset_url }}"
  type="module"
  fetchpriority="low"
></script>
<script
  src="{{ 'component-cart-quantity-selector.js' | asset_url }}"
  type="module"
  fetchpriority="low"
></script>
<script
  src="{{ 'volume-pricing-info.js' | asset_url }}"
  type="module"
  fetchpriority="low"
></script>

<div
  {{ block.shopify_attributes }}
  class="cart-items__wrapper"
  {% if settings.product_title_case == 'uppercase' %}
    style="--product-title-case: uppercase;"
  {% endif %}
>
  {% if cart.empty? or force_empty %}
    {%- if shop.customer_accounts_enabled and customer == null -%}
      <p class="agri-login-text">
        {{ 'actions.log_in_html' | t: link: routes.account_login_url }}
      </p>
    {%- endif -%}

    <div class="agri-empty-state">
      <span class="agri-empty-state__icon" aria-hidden="true">üå±</span>
      <p class="agri-empty-state__text">{{ 'content.your_cart_is_empty' | t }}</p>
      <p class="agri-empty-state__sub">Sow something great today!</p>
    </div>

    <a
      class="button cart-items__empty-button agri-empty-btn"
      href="{{ settings.empty_cart_button_link | default: routes.all_products_collection_url }}"
    >
      <span class="button-text">
        {{ 'actions.continue_shopping' | t }}
      </span>
    </a>
  {%- else -%}
    <span
      class="visually-hidden"
      ref="cartItemCount"
      aria-hidden="true"
    >
      {{- cart.item_count -}}
    </span>
    <form
      action="{{ routes.cart_url }}"
      class="cart-form"
      id="cart-form"
      method="post"
    >
      <div
        class="cart-items spacing-style{% if block_settings.dividers %} cart-items--dividers{% endif %}"
        style="{%  render 'spacing-style', settings: block_settings %} --cart-items-gap:{{ block_settings.gap | append: "px" }};"
      >
        <table
          class="cart-items__table"
          role="table"
        >
          <caption
            class="visually-hidden"
            role="caption"
          >
            {{ 'content.cart_total' | t }}
            <span>{{ cart.total_price | money_with_currency }}</span>
          </caption>

          <thead
            class="visually-hidden"
            role="rowgroup"
          >
            <tr
              role="row"
              class="cart-items__table-row"
            >
              <th id="productImage" scope="col" role="columnheader">{{ 'content.product_image' | t }}</th>
              <th id="productInformation" scope="col" role="columnheader">{{ 'content.product_information' | t }}</th>
              <th id="quantity" scope="col" role="columnheader">{{ 'content.quantity' | t }}</th>
              <th id="productTotal" scope="col" role="columnheader">{{ 'content.product_total' | t }}</th>
            </tr>
          </thead>

          <tbody role="rowgroup">
            {% for item in cart.items %}
              <tr
                role="row"
                class="cart-items__table-row agri-item-row{% if item.parent_relationship.parent != null %} cart-items__nested-line{% endif %}{% unless item.unit_price_measurement %} cart-items__table-row--full-width-variants{% endunless %}"
                ref="cartItemRows[]"
                data-parent-key="{{ item.parent_relationship.parent.key }}"
                data-key="{{ item.key }}"
              >
                <td
                  class="cart-items__media"
                  role="cell"
                  headers="productImage"
                >
                  {% if item.image -%}
                    {% liquid
                      assign ratio = 1
                      assign border_opacity = settings.cart_thumbnail_border_opacity | divided_by: 100.0
                      assign border_override = '--border-width: [cart_thumbnail_border_width]px; --border-style: [cart_thumbnail_border_style]; --border-color: rgb(var(--color-border-rgb) / [cart_thumbnail_border_opacity]); --border-radius: [cart_thumbnail_border_radius]px;' | replace: '[cart_thumbnail_border_width]', settings.cart_thumbnail_border_width | replace: '[cart_thumbnail_border_style]', settings.cart_thumbnail_border | replace: '[cart_thumbnail_border_opacity]', border_opacity | replace: '[cart_thumbnail_border_radius]', settings.cart_thumbnail_border_radius

                      if settings.cart_thumbnail_border_radius > 0
                        assign border_override = border_override | append: ' overflow: hidden;'
                      endif
                      if block_settings.image_ratio == 'portrait'
                        assign ratio = 0.8
                      elsif block_settings.image_ratio == 'adapt'
                        assign ratio = item.image.aspect_ratio
                      endif
                    %}
                    <a
                      href="{{ item.url }}"
                      class="cart-items__media-container agri-media-container"
                      style="--ratio:{{ ratio }};"
                    >
                      {%- liquid
                        echo item.image | image_url: width: 250 | image_tag: class: 'cart-items__media-image border-style', style: border_override
                      -%}
                    </a>
                  {%- endif %}
                </td>

                <td
                  class="cart-items__details cart-primary-typography"
                  role="cell"
                  headers="productInformation"
                >
                  <!-- Organic badge ‚Äî only shows if product has "organic" tag -->
                  {%- if item.product.tags contains 'organic' or item.product.tags contains 'Organic' -%}
                    <span class="agri-organic-badge" aria-hidden="true">üçÉ Organic</span>
                  {%- endif -%}

                  <div class="cart-items__product-info">
                    <p>
                      <a
                        href="{{ item.url }}"
                        class="cart-items__title agri-item-title"
                        {% if item.parent_relationship.parent != null %}
                          aria-label="{{ 'accessibility.nested_product' | t: product_title: item.product.title, parent_title: item.parent_relationship.parent.title | escape }}"
                        {% endif %}
                      >
                        {{- item.product.title -}}
                      </a>
                    </p>
                    {% if item.product.vendor and block_settings.vendor %}
                      <p class="agri-vendor">{{ item.product.vendor }}</p>
                    {% endif %}

                    {%- if item.item_components.size != 0 -%}
                      <ul class="cart-items__bundle list-unstyled">
                        {%- for component in item.item_components -%}
                          <li>
                            {{- component.title -}}
                            {%- if component.quantity > 1 -%}
                              <span> √ó {{ component.quantity }}</span>
                            {%- endif -%}
                          </li>
                        {%- endfor -%}
                      </ul>
                    {%- endif -%}
                  </div>

                  <div class="cart-items__variants-wrapper">
                    {%- if item.product.has_only_default_variant == false
                      or item.properties.size != 0
                      or item.selling_plan_allocation != null
                    -%}
                      {%- if item.product.has_only_default_variant == false and item.item_components.size == 0 -%}
                        <dl class="cart-items__variants">
                          {%- for option in item.options_with_values -%}
                            <div class="cart-items__variant">
                              <dt class="visually-hidden">{{ option.name }}:</dt>
                              <dd>
                                {{- option.value -}}
                                {%- if forloop.last != true %},&nbsp;{% endif -%}
                              </dd>
                            </div>
                          {%- endfor -%}
                        </dl>
                      {%- endif -%}

                      {%- liquid
                        assign has_visible_properties = false
                        for property in item.properties
                          assign property_first_char = property.first | slice: 0
                          if property.last != blank and property_first_char != '_'
                            assign has_visible_properties = true
                            break
                          endif
                        endfor
                      -%}
                      {%- if has_visible_properties -%}
                        <dl class="cart-items__properties">
                          {%- for property in item.properties -%}
                            {%- assign property_first_char = property.first | slice: 0 -%}
                            {%- if property.last != blank and property_first_char != '_' -%}
                              <div class="cart-items__property">
                                <dt>{{ property.first }}:</dt>
                                <dd>
                                  {%- if property.last contains '/uploads/' -%}
                                    <a href="{{ property.last }}">{{ property.last | split: '/' | last }}</a>
                                  {%- else -%}
                                    {{ property.last }}
                                  {%- endif -%}
                                </dd>
                              </div>
                            {%- endif -%}
                          {%- endfor -%}
                        </dl>
                      {%- endif -%}

                      {%- if item.selling_plan_allocation -%}
                        <p>{{ item.selling_plan_allocation.selling_plan.name }}</p>
                      {%- endif -%}

                      {%- if item.line_level_discount_allocations.size > 0 -%}
                        <ul class="list-unstyled agri-line-discounts" role="list">
                          {%- for discount in item.line_level_discount_allocations -%}
                            <li class="agri-line-discount-tag">
                              üè∑Ô∏è {{ discount.discount_application.title | escape }}
                            </li>
                          {%- endfor -%}
                        </ul>
                      {%- endif -%}
                    {%- endif -%}
                  </div>

                  <div class="cart-items__unit-price-wrapper">
                    <div class="agri-price-group">
                      {% if item.original_price != item.final_price %}
                        <span class="visually-hidden">{{ 'content.price_sale' | t }}</span>
                        <span class="agri-price-current">{{ item.final_price | money }}</span>
                        <span class="visually-hidden">{{ 'content.price_regular' | t }}</span>
                        <s class="compare-at-price agri-price-old">
                          {% if item.variant.compare_at_price > item.original_price %}
                            {{ item.variant.compare_at_price | money }}
                          {% else %}
                            {{ item.original_price | money }}
                          {% endif %}
                        </s>
                        {%- assign savings = item.original_price | minus: item.final_price -%}
                        {%- if savings > 0 -%}
                          <span class="agri-save-badge">Save {{ savings | money }}</span>
                        {%- endif -%}
                      {% else %}
                        {% if item.variant.compare_at_price > item.original_price %}
                          <span class="visually-hidden">{{ 'content.price_sale' | t }}</span>
                        {% else %}
                          <span class="visually-hidden">{{ 'content.price' | t }}</span>
                        {% endif %}
                        <span class="agri-price-current">{{ item.original_price | money }}</span>
                        {% if item.variant.compare_at_price > item.original_price %}
                          <span class="visually-hidden">{{ 'content.price_regular' | t }}</span>
                          <s class="compare-at-price agri-price-old">{{ item.variant.compare_at_price | money }}</s>
                        {% endif %}
                      {% endif %}
                    </div>
                  </div>
                </td>

                <td
                  class="cart-items__quantity"
                  role="cell"
                  headers="quantity"
                >
                  {% assign can_update_quantity = item.instructions.can_update_quantity | default: true, allow_false: true %}
                  <div class="cart-items__quantity-controls">
                    {% render 'volume-pricing-info',
                      variant: item.variant,
                      unique_id: item.index,
                      quantity: item.quantity
                    %}

                    {% render 'quantity-selector',
                      product: item.product,
                      variant: item.variant,
                      in_cart_quantity: item.quantity,
                      line_index: item.index,
                      class: 'cart-primary-typography',
                      can_update_quantity: can_update_quantity
                    %}

                    <button
                      class="button cart-items__remove agri-remove-btn"
                      type="button"
                      aria-label="{{ 'accessibility.remove_item' | t: title: item.title | escape }}"
                      on:click="/onLineItemRemove/{{ item.index | plus: 1 }}"
                      {% assign can_remove = item.instructions.can_remove | default: true, allow_false: true %}
                      {% if can_remove == false %}
                        hidden
                      {% endif %}
                    >
                      {{- 'icon-delete.svg' | inline_asset_content -}}
                      <span class="visually-hidden">{{ 'accessibility.remove' | t }}</span>
                    </button>
                  </div>
                </td>

                <td
                  class="cart-items__error hidden"
                  role="cell"
                  ref="cartItemErrorContainer-{{ item.index | plus: 1 }}"
                  headers="quantity"
                >
                  <div
                    class="cart-item__error"
                    role="alert"
                  >
                    <span class="svg-wrapper">
                      {{- 'icon-error.svg' | inline_asset_content -}}
                    </span>
                    <small
                      class="cart-item__error-text cart-primary-typography"
                      ref="cartItemError-{{ item.index | plus: 1 }}"
                    ></small>
                  </div>
                </td>

                {%- liquid
                  if settings.currency_code_enabled_cart_items
                    assign price = item.final_line_price | money_with_currency
                    assign unit_price = item.unit_price | money_with_currency
                  else
                    assign price = item.final_line_price | money
                    assign unit_price = item.unit_price | money
                  endif
                -%}
                <td
                  class="cart-items__price cart-secondary-typography agri-line-total"
                  role="cell"
                  headers="productTotal"
                >
                  <text-component value="{{ price | strip_html }}">{{ price }}</text-component>
                  {%- if item.unit_price_measurement -%}
                    <div class="cart-items__price-unit cart-secondary-typography">
                      {% render 'unit-price', price: unit_price, measurement: item.unit_price_measurement %}
                    </div>
                  {%- endif -%}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </form>
  {%- endif -%}
</div>

{% stylesheet %}
  /* ============================================
     AGRI THEME ‚Äî CART PRODUCTS
  ============================================ */
  :root {
    --agri-soil:       #3d2b1f;
    --agri-leaf:       #3a7d44;
    --agri-leaf-light: #5aab65;
    --agri-moss:       #2d5a27;
    --agri-wheat:      #c8a84b;
    --agri-cream:      #f5f0e8;
    --agri-sky:        #eaf4ea;
    --agri-border:     #c5dfc0;
  }

  /* ‚îÄ‚îÄ Wrapper background ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  .cart-items__wrapper {
    background-color: var(--agri-cream);
  }

  /* ‚îÄ‚îÄ Empty state ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  .agri-empty-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 24px 20px 0;
    text-align: center;
  }
  .agri-empty-state__icon {
    font-size: 52px;
    display: block;
    margin-bottom: 10px;
    animation: agri-sway 3s ease-in-out infinite;
  }
  @keyframes agri-sway {
    0%, 100% { transform: rotate(-6deg); }
    50%       { transform: rotate(6deg); }
  }
  .agri-empty-state__text {
    font-size: 15px;
    font-weight: 600;
    color: var(--agri-soil);
    margin-bottom: 4px;
  }
  .agri-empty-state__sub {
    font-size: 12px;
    color: #7a6a58;
    margin-bottom: 0;
  }
  .agri-empty-btn {
    background: linear-gradient(135deg, var(--agri-moss), var(--agri-leaf)) !important;
    color: #fff !important;
    border: none !important;
    border-radius: 8px !important;
    box-shadow: 0 4px 14px rgba(45, 90, 39, 0.3) !important;
    transition: transform 0.15s, box-shadow 0.2s !important;
  }
  .agri-empty-btn:hover {
    transform: translateY(-2px) !important;
    box-shadow: 0 6px 20px rgba(45, 90, 39, 0.4) !important;
  }

  /* ‚îÄ‚îÄ Item row card ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  .agri-item-row {
    background: #ffffff;
    border: 1.5px solid var(--agri-border) !important;
    border-radius: 10px !important;
    padding: 12px !important;
    box-shadow: 0 2px 8px rgba(58, 125, 68, 0.07);
    transition: box-shadow 0.2s;
    overflow: visible !important;
  }
  .agri-item-row:hover {
    box-shadow: 0 4px 16px rgba(58, 125, 68, 0.14);
  }

  /* ‚îÄ‚îÄ Product image frame ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  .agri-media-container {
    border: 2px solid var(--agri-border) !important;
    border-radius: 8px !important;
    background: var(--agri-sky);
    overflow: hidden;
  }

  /* ‚îÄ‚îÄ Organic badge ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  .agri-organic-badge {
    display: inline-block;
    background: var(--agri-leaf);
    color: #fff;
    font-size: 9px;
    font-weight: 700;
    letter-spacing: 0.5px;
    padding: 2px 7px;
    border-radius: 0 0 5px 5px;
    text-transform: uppercase;
    margin-bottom: 4px;
  }

  /* ‚îÄ‚îÄ Vendor label ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  .agri-vendor {
    font-size: 10px !important;
    font-weight: 700 !important;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--agri-leaf) !important;
  }

  /* ‚îÄ‚îÄ Item title ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  .agri-item-title {
    color: var(--agri-soil) !important;
    font-weight: 700 !important;
  }
  .agri-item-title:hover {
    color: var(--agri-leaf) !important;
    text-decoration: underline !important;
  }

  /* ‚îÄ‚îÄ Prices ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  .agri-price-group {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 4px;
  }
  .agri-price-current {
    font-weight: 700;
    color: var(--agri-moss);
  }
  .agri-price-old {
    color: #aaa !important;
    font-size: 11px !important;
  }
  .agri-save-badge {
    display: inline-block;
    background: #fff3cd;
    color: #856404;
    font-size: 9.5px;
    font-weight: 700;
    padding: 1px 5px;
    border-radius: 4px;
    border: 1px solid #ffc107;
    vertical-align: middle;
  }

  /* ‚îÄ‚îÄ Line total ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  .agri-line-total {
    color: var(--agri-soil) !important;
    font-weight: 700 !important;
  }

  /* ‚îÄ‚îÄ Line discount tags ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  .agri-line-discount-tag {
    display: inline-block;
    background: #fff3cd;
    color: #856404;
    font-size: 10px;
    font-weight: 700;
    padding: 2px 7px;
    border-radius: 4px;
    border: 1px solid #ffc107;
    margin-top: 4px;
  }

  /* ‚îÄ‚îÄ Quantity selector ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  .cart-items .quantity-selector {
    border: 1.5px solid var(--agri-border) !important;
    border-radius: 8px !important;
    background: var(--agri-sky) !important;
    overflow: hidden;
  }
  .cart-items .quantity-selector button {
    color: var(--agri-leaf) !important;
    background: transparent !important;
  }
  .cart-items .quantity-selector button:hover {
    background: #c8e6c9 !important;
  }

  /* ‚îÄ‚îÄ Remove button ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  .agri-remove-btn {
    color: #c0392b !important;
    opacity: 0.5;
    transition: opacity 0.2s, transform 0.15s !important;
  }
  .agri-remove-btn:hover {
    opacity: 1 !important;
    transform: scale(1.15) !important;
    background: transparent !important;
    box-shadow: none !important;
  }

  /* ‚îÄ‚îÄ Original layout styles ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  .cart-items {
    --cart-item-media-width-min: 2.5rem;
    --cart-item-media-width-max: 7.5rem;
    container-name: cart-items;
    container-type: inline-size;
    width: 100%;
  }

  .cart-items-disabled { pointer-events: none; }

  .cart-page--empty .cart-items__wrapper {
    display: flex; flex-direction: column; align-items: center; margin-block-start: 0; text-align: center;
  }

  .cart-drawer:not(:has(.cart-form)) .cart-items__wrapper {
    display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;
  }

  .cart-items__table { width: 100%; border-spacing: 0; }
  .cart-items__table * { margin: 0; }

  .cart-items__table-row {
    --cart-item-price-width: 6rem;
    display: grid;
    grid-template-columns: clamp(2.5rem, 15cqi, 7.5rem) minmax(0, 1fr) minmax(var(--cart-item-price-width), auto);
    grid-template-areas:
      'media details price'
      'media quantity price'
      'media error error';
    column-gap: var(--gap-md);
    align-items: start;
    padding-bottom: var(--cart-items-gap);
    margin-bottom: var(--margin-lg);
  }

  .cart-drawer .cart-items__table-row--full-width-variants {
    grid-template-columns: clamp(2.5rem, 15cqi, 7.5rem) minmax(0, 1fr) auto;
    grid-template-rows: repeat(4, min-content) 1fr;
    grid-template-areas:
      'media details price'
      'media variants variants'
      'media unit_price unit_price'
      'media quantity quantity'
      'media error error';
    .cart-items__details { display: contents; }
    .cart-items__product-info { grid-area: details; }
    .cart-items__variants-wrapper { grid-area: variants; &:empty { display: none; } p { margin: 0; } }
    .cart-items__unit-price-wrapper { grid-area: unit_price; font-size: var(--font-size--sm); }
    .cart-items__price { min-width: auto; width: max-content; }
  }

  .cart-items__table-row.cart-items__nested-line td:first-child { width: 60%; justify-self: right; }

  html:active-view-transition-type(page-navigation) .cart-items__table-row {
    /* stylelint-disable-next-line declaration-no-important */
    view-transition-name: none !important;
  }

  .cart-items__table-row.removing {
    overflow: hidden;
    animation: removeRow calc(var(--animation-speed) * 2) var(--animation-easing) forwards;
    animation-delay: var(--animation-speed);
  }

  @keyframes removeRow {
    0%   { height: var(--row-height); }
    100% { opacity: 0; height: 0; padding-bottom: 0; margin-bottom: 0; border-color: transparent; }
  }

  .cart-items__table-row:last-child { padding-bottom: 0; }

  .cart-items--dividers .cart-items__table-row {
    border-bottom: 1px solid var(--agri-border);
    margin-bottom: var(--cart-items-gap);
  }
  .cart-items--dividers .cart-items__table-row:has(+ .cart-items__nested-line) { border-bottom: none; margin-bottom: 0; }
  .cart-items--dividers .cart-items__table-row:last-of-type { border-block-end: none; padding-block-end: 0; margin-bottom: 0; }

  .cart-items__details { grid-area: details; color: rgb(var(--color-foreground-rgb) / var(--opacity-70)); }
  .cart-items__details > * + *, .cart-items__bundle li { margin-block-start: var(--margin-3xs); }
  .cart-items__details * { font-size: var(--font-size--sm); }
  .cart-items__details a { text-decoration: none; }

  .cart-items__title {
    font-size: var(--font-size--md);
    color: var(--color-foreground);
    text-transform: var(--product-title-case);
    display: block;
    margin-block-start: calc((var(--font-size--md) - 1lh) / 2);
  }

  .cart-items__variants { display: block; }
  .cart-items__variant { display: inline; }
  .cart-items__variant dt, .cart-items__variant dd { display: inline; margin: 0; }

  .cart-items__quantity {
    grid-area: quantity;
    margin-block-start: var(--margin-xs);
    display: flex;
    align-items: center;
    justify-content: flex-start;
    gap: var(--gap-xs);
    width: fit-content;
  }

  .cart-items__quantity-controls {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    gap: var(--gap-xs);
    width: fit-content;
  }

  .cart-items__quantity-controls > .volume-pricing-info {
    margin-inline-start: calc(-1 * var(--minimum-touch-target) - var(--gap-xs));
  }

  .cart-items__quantity .quantity-selector { display: inline-flex; font-size: var(--font-size--sm); height: auto; }

  .cart-items__remove {
    background-color: transparent;
    color: var(--color-foreground);
    width: var(--minimum-touch-target);
    height: var(--minimum-touch-target);
    justify-content: center;
    box-shadow: none;
    padding: 0;
  }

  .cart-items__media { grid-area: media; padding: 0; }

  .cart-items__price {
    grid-area: price;
    min-height: unset;
    min-width: var(--cart-item-price-width);
    text-align: end;
    display: block;
    font-size: var(--font-size--sm);
    line-height: var(--line-height);
  }

  .cart-items__price-unit { font-size: var(--font-size--xs); padding-block-start: var(--padding-2xs); }

  .cart-items__media-container {
    display: flex;
    aspect-ratio: var(--ratio);
    position: relative;
    width: 100%;
    overflow: hidden;
  }

  .cart-items__media-image {
    aspect-ratio: inherit;
    object-fit: cover;
    object-position: center center;
    width: 100%;
    height: auto;
  }

  .cart-items__empty-button {
    margin-top: var(--margin-md);
    padding-inline: var(--padding-4xl);
    padding-block: var(--padding-lg);
  }

  .cart-items__error {
    display: flex;
    align-items: flex-start;
    width: 100%;
    grid-area: error;
    margin-block-start: var(--margin-xs);
    opacity: 1;
    overflow: hidden;
    transform: translateY(0);
    transition: opacity var(--drawer-animation-speed) var(--animation-easing),
      transform var(--drawer-animation-speed) var(--animation-easing);
    @starting-style { opacity: 0; transform: translateY(-0.5rem); }
  }

  .cart-item__error { display: flex; align-items: flex-start; width: 100%; font-size: var(--font-size--sm); padding-block: var(--padding-2xs); }
  .cart-item__error .svg-wrapper { flex-shrink: 0; width: var(--icon-size-xs); height: var(--icon-size-xs); margin-inline: var(--margin-3xs) var(--margin-xs); margin-block-start: var(--margin-3xs); }

  @container cart-items (min-width: 720px) {
    .cart-items__table-row {
      --cart-item-price-width: 6rem;
      grid-template-columns: 7.5rem 1fr 1fr minmax(var(--cart-item-price-width), auto);
      grid-template-rows: min-content 1fr;
      grid-template-areas:
        'media details quantity price'
        'media details error error';
    }
    .cart-items__quantity, .cart-items__price { grid-area: initial; }
    .cart-items__quantity { margin-top: 0; }
    .cart-items__price { min-height: var(--minimum-touch-target); display: flex; flex-direction: column; align-items: flex-end; }
    .cart-drawer .cart-items__table-row--full-width-variants {
      grid-template-rows: min-content min-content min-content 1fr;
      grid-template-areas:
        'media details quantity price'
        'media variants variants variants'
        'media unit_price unit_price unit_price'
        'media error error error';
      .cart-items__quantity, .cart-items__price { grid-area: initial; }
    }
  }

  .cart__subtotal-container, .cart__total-container { display: flex; flex-direction: column; }
  .cart__total-container { row-gap: var(--gap-2xs); &.cart__total-container--has-installments { row-gap: var(--gap-xs); } }
  .cart__subtotal-container:empty { display: none; }
  .cart__summary-totals {
    display: flex; flex-direction: column; gap: var(--gap-xl); width: 100%; border-block-start: none;
    &:has(> :first-child:not(.cart__subtotal-container, .cart__total-container)) { padding-block-start: 0; border-block-start: none; }
    @media screen and (min-width: 750px) { padding-block-start: 0; }
  }
  .cart__subtotal-container, .cart__subtotal-container * { font-size: var(--font-size--sm); }
  .cart__total { font-weight: var(--font-weight-bold); }
  .cart__total-label { font-size: var(--font-size--sm); }
  .cart__total-value { font-size: var(--font-size--xl); @media screen and (max-width: 749px) { font-size: var(--font-size--lg); } }

  .cart-primary-typography { font-family: var(--cart-primary-font-family); font-style: var(--cart-primary-font-style); font-weight: var(--cart-primary-font-weight); }
  .cart-secondary-typography { font-family: var(--cart-secondary-font-family); font-style: var(--cart-secondary-font-style); font-weight: var(--cart-secondary-font-weight); }

  .cart__ctas { width: 100%; display: grid; gap: var(--checkout-button-gap); grid-auto-flow: row; grid-template-columns: 1fr; }
  .cart__additional-checkout-buttons { width: 100%; }

  shopify-accelerated-checkout-cart {
    --shopify-accelerated-checkout-inline-alignment: center;
    --shopify-accelerated-checkout-button-border-radius: var(--style-border-radius-buttons-primary);
    --shopify-accelerated-checkout-row-gap: var(--checkout-button-gap, 10px);
  }

  .remove-icon-bottom, .remove-icon-top { transition: transform var(--animation-speed) var(--animation-easing); }
  .cart-items__remove:hover .remove-icon-top { transform: translate(calc(-1 * var(--icon-stroke-width)), var(--icon-stroke-width)) rotate(-15deg); }
  .cart-items__remove:is(:hover, :active) .remove-icon-bottom { transform: translateY(var(--icon-stroke-width)); }
  .cart-items__table-row.removing .remove-icon-bottom { transform: translateY(0); }
  .cart-items__table-row.removing .remove-icon-top { animation: removeButtonClickedIconTop var(--animation-speed) var(--animation-easing) forwards; }

  @keyframes removeButtonClickedIconTop {
    50%  { transform: translate(0, calc(-1 * var(--icon-stroke-width))); }
    100% { transform: translate(0, 0); }
  }

  .cart-items__properties { display: block; margin-block-start: var(--margin-2xs); }
  .cart-items__property { display: block; }
  .cart-items__properties dt, .cart-items__properties dd { display: inline; margin: 0; overflow-wrap: break-word; }

  @media screen and (min-width: 750px) {
    .cart-items .quantity-selector { --quantity-selector-width: 105px; height: var(--button-size-md); width: var(--quantity-selector-width); }
    .cart-items .quantity-selector button { width: var(--button-size-md); height: var(--button-size-md); }
    .cart-items .quantity-selector input { max-width: calc(var(--quantity-selector-width) - var(--button-size-md) * 2); }
  }

  @media screen and (prefers-reduced-motion: no-preference) {
    html:active-view-transition-type(empty-cart-drawer) {
      .cart-items__empty-button, .cart__checkout-button {
        view-transition-name: cart-drawer-primary-action;
        & > .button-text { view-transition-name: cart-drawer-primary-action-text; }
      }
    }
  }

  ::view-transition-old(cart-drawer-primary-action-text),
  ::view-transition-new(cart-drawer-primary-action-text) { height: 100%; object-fit: none; overflow: clip; overflow-clip-margin: 1em; }
  ::view-transition-old(cart-drawer-primary-action-text) { animation: cart-drawer-primary-action-text var(--animation-speed) var(--animation-easing) reverse forwards; }
  ::view-transition-new(cart-drawer-primary-action-text) { animation: cart-drawer-primary-action-text var(--animation-speed) var(--animation-easing) forwards; }
  ::view-transition-old(cart-drawer-primary-action), ::view-transition-new(cart-drawer-primary-action) { height: 100%; }
  ::view-transition-group(cart-drawer-primary-action-text), ::view-transition-group(cart-drawer-primary-action) {
    animation-duration: var(--spring-d300-b0-duration);
    animation-timing-function: var(--spring-d300-b0-easing);
  }

  @keyframes cart-drawer-primary-action-text {
    from { filter: blur(3px); opacity: 0; }
    to   { filter: none; opacity: 1; }
  }

  /* ============================================
     MOBILE FRIENDLY ‚Äî max-width: 749px
  ============================================ */
  @media screen and (max-width: 749px) {

    /* ‚îÄ‚îÄ Item card mobile layout ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
       Image | Title + Price
              | Qty + Remove
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .agri-item-row {
      padding: 10px !important;
      border-radius: 10px !important;
      margin-bottom: 10px !important;
    }

    /* Tighter grid on mobile: smaller image, full details */
    .cart-items__table-row {
      grid-template-columns: 72px minmax(0, 1fr) !important;
      grid-template-rows: auto auto auto !important;
      grid-template-areas:
        'media details'
        'media quantity'
        'media error' !important;
      column-gap: 10px !important;
      padding-bottom: 0 !important;
    }

    /* Price sits inside details column on mobile (top-right corner) */
    .cart-items__price {
      grid-area: unset !important;
      text-align: right !important;
      min-width: unset !important;
      font-size: var(--font-size--sm) !important;
      font-weight: 700 !important;
    }

    /* Details: price floats to top right */
    .cart-items__details {
      display: flex !important;
      flex-direction: column !important;
      gap: 3px !important;
    }

    /* Product info row: title left, price right */
    .cart-items__product-info {
      display: flex !important;
      justify-content: space-between !important;
      align-items: flex-start !important;
      gap: 6px !important;
    }

    /* Move price cell visually next to title */
    .cart-items__price {
      order: -1;
    }

    /* Title font smaller on mobile */
    .cart-items__title,
    .agri-item-title {
      font-size: 13px !important;
      line-height: 1.3 !important;
    }

    /* Variants + properties smaller */
    .cart-items__details * {
      font-size: 11px !important;
    }

    /* Organic badge compact */
    .agri-organic-badge {
      font-size: 8px !important;
      padding: 1px 5px !important;
    }

    /* Save badge compact */
    .agri-save-badge {
      font-size: 8.5px !important;
      padding: 1px 4px !important;
    }

    /* Price group wraps neatly */
    .agri-price-group {
      flex-wrap: wrap !important;
      gap: 3px !important;
    }

    .agri-price-current {
      font-size: 13px !important;
    }

    .agri-price-old {
      font-size: 10px !important;
    }

    /* Quantity controls: smaller touch targets still accessible */
    .cart-items__quantity {
      margin-block-start: 6px !important;
      gap: 6px !important;
    }

    .cart-items__quantity-controls {
      gap: 6px !important;
      flex-wrap: nowrap !important;
      align-items: center !important;
    }

    /* Quantity selector smaller on mobile */
    .cart-items .quantity-selector {
      --quantity-selector-width: 90px !important;
      height: 34px !important;
      width: 90px !important;
    }

    .cart-items .quantity-selector button {
      width: 30px !important;
      height: 34px !important;
      font-size: 16px !important;
      min-width: 30px !important;
    }

    .cart-items .quantity-selector input {
      max-width: 30px !important;
      font-size: 13px !important;
      text-align: center !important;
    }

    /* Remove button ‚Äî smaller but still 44px touch area */
    .agri-remove-btn,
    .cart-items__remove {
      width: 36px !important;
      height: 36px !important;
      min-width: 36px !important;
      opacity: 0.6 !important;
    }

    /* Line total in price cell */
    .agri-line-total {
      font-size: 14px !important;
    }

    /* Image frame on mobile */
    .agri-media-container {
      border-radius: 6px !important;
    }

    /* Empty state smaller on mobile */
    .agri-empty-state__icon {
      font-size: 42px !important;
    }
    .agri-empty-state__text {
      font-size: 14px !important;
    }
    .cart-items__empty-button.agri-empty-btn {
      padding-inline: var(--padding-2xl) !important;
      width: 100% !important;
      max-width: 280px !important;
    }

    /* Discount tags smaller */
    .agri-line-discount-tag {
      font-size: 9px !important;
      padding: 1px 5px !important;
    }

    /* Table full width */
    .cart-items__table {
      width: 100% !important;
    }
  }

  /* ‚îÄ‚îÄ Extra small screens (< 380px) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  @media screen and (max-width: 380px) {
    .agri-item-row {
      padding: 8px !important;
    }

    .cart-items__table-row {
      grid-template-columns: 60px minmax(0, 1fr) !important;
      column-gap: 8px !important;
    }

    .agri-item-title,
    .cart-items__title {
      font-size: 12px !important;
    }

    .cart-items .quantity-selector {
      --quantity-selector-width: 80px !important;
      width: 80px !important;
    }

    .cart-items .quantity-selector button {
      width: 26px !important;
      min-width: 26px !important;
    }

    .cart-items .quantity-selector input {
      max-width: 28px !important;
    }

    .agri-remove-btn,
    .cart-items__remove {
      width: 32px !important;
      height: 32px !important;
      min-width: 32px !important;
    }
  }
{% endstylesheet %}
