{% comment %}
Mega Menu Section - Agriculture Theme
v3: Separate Banner Block with image upload + editable text + collection picker
{% endcomment %}

<style>
.mega-menu-wrapper {
  background-color: {{ section.settings.menu_bg_color }};
  position: relative;
  z-index: 4;
  width: 100%;
}

.mega-menu-container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 20px;
}

.main-menu {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0;
  list-style: none;
  margin: 0;
  padding: 0;
}

.menu-item {
  position: static;
}

.menu-item > a {
  display: block;
  padding: {{ section.settings.menu_padding }}px 20px;
  color: {{ section.settings.menu_text_color }};
  text-decoration: none;
  font-size: {{ section.settings.menu_font_size }}px;
  font-weight: {{ section.settings.menu_font_weight }};
  text-transform: {{ section.settings.menu_text_transform }};
  transition: all 0.3s ease;
  white-space: nowrap;
}

.menu-item > a:hover {
  background-color: {{ section.settings.menu_hover_bg }};
  color: {{ section.settings.menu_hover_color }};
}

.menu-item.has-mega-menu > a::after {
  content: '\25BC';
  font-size: 10px;
  margin-left: 8px;
  transition: transform 0.3s ease;
}

.menu-item.has-mega-menu:hover > a::after {
  transform: rotate(180deg);
}

/* ============================================
   Mega Menu Dropdown
   ============================================ */
.mega-menu {
  display: none;
  position: absolute;
  left: 0;
  right: 0;
  width: 100%;
  background: linear-gradient(135deg, #f8fdf8 0%, #e8f5e9 100%);
  border-top: 3px solid #4caf50;
  box-shadow: 0 8px 24px rgba(76, 175, 80, 0.15);
  padding: 40px 0;
  z-index: 999;
}

.menu-item.has-mega-menu:hover .mega-menu {
  display: block;
}

.mega-menu::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background-image: repeating-linear-gradient(
    45deg,
    transparent,
    transparent 35px,
    rgba(76, 175, 80, 0.03) 35px,
    rgba(76, 175, 80, 0.03) 70px
  );
  pointer-events: none;
}

.mega-menu::after {
  content: 'ðŸŒ¿';
  position: absolute;
  top: 20px;
  right: 40px;
  font-size: 60px;
  opacity: 0.1;
  pointer-events: none;
}

/* ============================================
   Main Grid: Left + Right
   ============================================ */
.mega-menu-content {
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 50px;
  display: grid;
  grid-template-columns: 300px 1fr;
  gap: 40px;
  position: relative;
  z-index: 1;
}

/* ============================================
   LEFT SIDE - Menu Column with 2-col links
   ============================================ */
.mega-menu-left {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.mega-menu-column {
  background: white;
  border-radius: 12px;
  padding: 25px 20px;
  box-shadow: 0 4px 12px rgba(76, 175, 80, 0.08);
  border: 2px solid transparent;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
  opacity: 0;
  animation: slideDown 0.3s ease forwards;
}

.mega-menu-column::before {
  content: '';
  position: absolute;
  top: 0; left: 0;
  width: 5px;
  height: 100%;
  background: linear-gradient(180deg, #4caf50, #8bc34a);
  transform: scaleY(0);
  transition: transform 0.3s ease;
}

.mega-menu-column:hover {
  border-color: #4caf50;
  box-shadow: 0 8px 24px rgba(76, 175, 80, 0.15);
  transform: translateY(-3px);
}

.mega-menu-column:hover::before {
  transform: scaleY(1);
}

.mega-menu-column h3 {
  font-size: 15px;
  font-weight: 700;
  margin-bottom: 15px;
  color: #2e7d32;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  padding-bottom: 12px;
  border-bottom: 2px solid #e8f5e9;
  display: flex;
  align-items: center;
  gap: 8px;
}

.mega-menu-column h3::before {
  content: 'ðŸŒ¾';
  font-size: 16px;
}

/* TWO COLUMN LINKS */
.mega-menu-links {
  list-style: none;
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 4px 12px;
}

.mega-menu-links li {
  margin-bottom: 8px;
  position: relative;
  padding-left: 18px;
}

.mega-menu-links li::before {
  content: 'ðŸŒ±';
  position: absolute;
  left: 0;
  font-size: 11px;
  transition: transform 0.2s ease;
}

.mega-menu-links li:hover::before {
  transform: scale(1.3);
}

.mega-menu-links a {
  color: #424242;
  text-decoration: none;
  font-size: 13px;
  font-weight: 500;
  transition: all 0.2s ease;
  display: inline-block;
  position: relative;
}

.mega-menu-links a::after {
  content: '';
  position: absolute;
  bottom: -2px; left: 0;
  width: 0;
  height: 2px;
  background: linear-gradient(90deg, #4caf50, #8bc34a);
  transition: width 0.3s ease;
}

.mega-menu-links a:hover {
  color: #2e7d32;
  transform: translateX(4px);
}

.mega-menu-links a:hover::after {
  width: 100%;
}

/* Featured Badge */
.mega-menu-column.featured::after {
  content: 'ðŸŒŸ à¤µà¤¿à¤¶à¥‡à¤·';
  position: absolute;
  top: 12px; right: 12px;
  background: linear-gradient(135deg, #ffd54f, #ffb300);
  color: #d84315;
  padding: 4px 10px;
  border-radius: 15px;
  font-size: 11px;
  font-weight: 700;
  box-shadow: 0 2px 8px rgba(255, 193, 7, 0.3);
}

/* ============================================
   RIGHT SIDE - Banner + Products
   ============================================ */
.mega-menu-right {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

/* ============================================
   BANNER - Image Upload Style
   ============================================ */
.mega-banner-wrap {
  display: block;
  border-radius: 12px;
  overflow: hidden;
  text-decoration: none;
  position: relative;
  opacity: 0;
  animation: slideDown 0.25s ease forwards;
  box-shadow: 0 4px 16px rgba(0,0,0,0.12);
  transition: all 0.3s ease;
  min-height: 100px;
}

.mega-banner-wrap:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 28px rgba(0,0,0,0.18);
}

/* When custom image is uploaded */
.mega-banner-wrap.has-image {
  height: 130px;
}

.mega-banner-wrap.has-image img.banner-bg-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  transition: transform 0.4s ease;
}

.mega-banner-wrap.has-image:hover img.banner-bg-img {
  transform: scale(1.04);
}

/* Dark overlay on image */
.mega-banner-wrap.has-image .banner-overlay {
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(0,0,0,0.52) 0%, rgba(0,0,0,0.18) 100%);
}

/* Fallback: no image â€” show green gradient */
.mega-banner-wrap.no-image {
  background: linear-gradient(135deg, #2e7d32, #4caf50);
  padding: 20px 25px;
}

.mega-banner-wrap.no-image::after {
  content: 'ðŸŒ¾';
  position: absolute;
  right: 20px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 50px;
  opacity: 0.25;
  pointer-events: none;
}

/* Banner text â€” sits on top of both image and gradient */
.banner-text-block {
  position: absolute;
  bottom: 0; right: 0;
  padding: 14px 20px;
  z-index: 2;
}

.mega-banner-wrap.no-image .banner-text-block {
  position: static;
  padding: 0;
}

.banner-text-block .banner-label {
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  color: rgba(255,255,255,0.85);
  margin-bottom: 4px;
}

.banner-text-block .banner-title {
  font-size: 18px;
  font-weight: 700;
  color: #ffffff;
  line-height: 1.25;
  margin-bottom: 8px;
  text-shadow: 0 1px 4px rgba(0,0,0,0.3);
}

.mega-banner-wrap.no-image .banner-text-block .banner-title {
  font-size: 20px;
  margin-bottom: 10px;
}

.banner-text-block .banner-cta {
  display: inline-block;
  background: rgba(255,255,255,0.22);
  border: 1px solid rgba(255,255,255,0.4);
  padding: 5px 14px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  color: #fff;
  transition: background 0.2s ease;
}

.mega-banner-wrap:hover .banner-cta {
  background: rgba(255,255,255,0.38);
}

/* ============================================
   4 Product Cards Grid
   ============================================ */
.mega-products-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 16px;
}

.mega-product-card {
  background: white;
  border-radius: 12px;
  padding: 12px;
  box-shadow: 0 4px 12px rgba(76, 175, 80, 0.08);
  border: 2px solid #e8f5e9;
  transition: all 0.3s ease;
  text-align: center;
  opacity: 0;
  animation: slideDown 0.3s ease forwards;
  position: relative;
  overflow: hidden;
}

.mega-product-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 3px;
  background: linear-gradient(90deg, #4caf50, #8bc34a);
  transform: scaleX(0);
  transition: transform 0.3s ease;
}

.mega-product-card:hover {
  border-color: #4caf50;
  box-shadow: 0 8px 24px rgba(76, 175, 80, 0.15);
  transform: translateY(-5px);
}

.mega-product-card:hover::before {
  transform: scaleX(1);
}

.mega-product-image {
  width: 100%;
  height: 150px;
  object-fit: cover;
  border-radius: 8px;
  margin-bottom: 10px;
  border: 2px solid #f1f8e9;
  transition: all 0.3s ease;
}

.mega-product-card:hover .mega-product-image {
  border-color: #4caf50;
  transform: scale(1.04);
}

.mega-product-placeholder {
  width: 100%;
  height: 150px;
  border-radius: 8px;
  background: #e8f5e9;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 10px;
  font-size: 36px;
}

.mega-product-title {
  font-size: 13px;
  font-weight: 600;
  color: #2e7d32;
  margin-bottom: 6px;
  line-height: 1.3;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.mega-product-price {
  font-size: 15px;
  font-weight: 700;
  color: #e31e24;
  margin-bottom: 8px;
}

.mega-product-btn {
  display: inline-block;
  padding: 6px 14px;
  background: linear-gradient(135deg, #4caf50, #66bb6a);
  color: white;
  text-decoration: none;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  transition: all 0.3s ease;
  box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
}

.mega-product-btn:hover {
  background: linear-gradient(135deg, #388e3c, #4caf50);
  transform: scale(1.05);
}

/* Mobile Toggle */
.mobile-menu-toggle {
  display: none;
  background: transparent;
  border: none;
  color: {{ section.settings.menu_text_color }};
  font-size: 12px;
  padding: 5px 0px;
  cursor: pointer;
}

/* Animations */
@keyframes slideDown {
  from { opacity: 0; transform: translateY(-10px); }
  to   { opacity: 1; transform: translateY(0); }
}

.mega-menu-column:nth-child(1) { animation-delay: 0.05s; }
.mega-menu-column:nth-child(2) { animation-delay: 0.10s; }
.mega-banner-wrap               { animation-delay: 0.08s; }
.mega-product-card:nth-child(1) { animation-delay: 0.10s; }
.mega-product-card:nth-child(2) { animation-delay: 0.15s; }
.mega-product-card:nth-child(3) { animation-delay: 0.20s; }
.mega-product-card:nth-child(4) { animation-delay: 0.25s; }

/* ============================================
   Mobile Responsive
   ============================================ */
@media (max-width: 768px) {
  .mega-menu-content { overflow: auto;}
.mega-menu-container { position: fixed;
        bottom: 64px;
        background: green;
        width: 100%;
        border: 2px solid #fff;
        box-shadow: 9px 2px 18px 5px #00000061;
        display: inline-flex;
        justify-content: center;
        max-width: 112px;
        margin: 0 auto;
        text-align: center;
        align-items: center;
        border-radius: 10px;
        right: 37%; }


  .mobile-menu-toggle { display: block; }

  .main-menu {
    display: none;
   flex-direction: column;
        width: 112vw;
        background: #e31e24;
        position: relative;
        bottom: 47px;
        left: 0px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        z-index: 1000;
    
  }

  .main-menu.active { display: flex; }

  .menu-item {
    width: 100%;
    border-bottom: 1px solid rgba(255,255,255,0.1);
  }

  .menu-item > a { padding: 15px 20px; }

  .mega-menu {
    {% comment %} position: static !important; {% endcomment %}
    width: 100% !important;
    padding: 20px 0 !important;
    background: #f1f8e9 !important;
    box-shadow: none !important;
    border: none !important;
    display: none !important;
  }

  .mega-menu-content {
    grid-template-columns: 1fr !important;
    padding: 15px !important;
    gap: 15px !important;
  }

  .mega-menu-links {
    grid-template-columns: 1fr !important;
  }

  .mega-menu-column {
    padding: 15px !important;
    animation: none !important;
    opacity: 1 !important;
  }

  .mega-banner-wrap {
    animation: none !important;
    opacity: 1 !important;
  }

  .mega-banner-wrap.has-image {
    height: 100px !important;
  }

  .mega-products-grid {
    grid-template-columns: repeat(2, 1fr) !important;
    gap: 10px !important;
  }

  .mega-product-card {
    animation: none !important;
    opacity: 1 !important;
  }

  .mega-product-image,
  .mega-product-placeholder {
    height: 110px !important;
  }

  .mega-menu::before,
  .mega-menu::after { display: none; }

  .menu-item.has-mega-menu.mobile-open .mega-menu {
    display: block !important;
  }
}
</style>

<div class="mega-menu-wrapper">
  <div class="mega-menu-container">
    <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">&#9776; <span style="display: block;"> Catagory </span></button>

    <nav>
      <ul class="main-menu" id="mainMenu">
        {%- for link in section.settings.main_menu.links -%}
          {%- assign mega_menu_array = section.settings.mega_menu_items | split: ',' -%}
          {%- assign has_mega = false -%}

          {%- for item in mega_menu_array -%}
            {%- assign item_trimmed = item | strip -%}
            {%- assign link_title_trimmed = link.title | strip -%}
            {%- if item_trimmed == link_title_trimmed -%}
              {%- assign has_mega = true -%}
              {%- break -%}
            {%- endif -%}
          {%- endfor -%}

          <li class="menu-item{%- if has_mega %} has-mega-menu{%- endif -%}" onclick="toggleMegaMenuMobile(event)">
            <a href="{{ link.url }}">{{ link.title }}</a>

            {%- if has_mega -%}
              <div class="mega-menu">
                <div class="mega-menu-content">

                  {%- comment -%} ===== LEFT: Menu Columns ===== {%- endcomment -%}
                  <div class="mega-menu-left">
                    {%- for block in section.blocks -%}
                      {%- if block.type == 'mega_menu_column' -%}
                        {%- assign parent_trimmed    = block.settings.parent_menu_item | strip -%}
                        {%- assign link_title_trimmed = link.title | strip -%}
                        {%- if parent_trimmed == link_title_trimmed -%}
                          <div class="mega-menu-column{% if block.settings.is_featured %} featured{% endif %}">
                            {%- if block.settings.column_heading != blank -%}
                              <h3>{{ block.settings.column_heading }}</h3>
                            {%- endif -%}
                            {%- if block.settings.column_menu != blank -%}
                              <ul class="mega-menu-links">
                                {%- for child_link in block.settings.column_menu.links -%}
                                  <li><a href="{{ child_link.url }}">{{ child_link.title }}</a></li>
                                {%- endfor -%}
                              </ul>
                            {%- endif -%}
                          </div>
                        {%- endif -%}
                      {%- endif -%}
                    {%- endfor -%}
                  </div>

                  {%- comment -%} ===== RIGHT: Banner + Products ===== {%- endcomment -%}
                  <div class="mega-menu-right">

                    {%- comment -%} --- BANNER BLOCK (separate block type) --- {%- endcomment -%}
                    {%- for block in section.blocks -%}
                      {%- if block.type == 'menu_banner' -%}
                        {%- assign parent_trimmed    = block.settings.parent_menu_item | strip -%}
                        {%- assign link_title_trimmed = link.title | strip -%}
                        {%- if parent_trimmed == link_title_trimmed -%}

                          {%- assign banner_link = block.settings.banner_link | default: '#' -%}

                          {%- if block.settings.banner_image != blank -%}
                            {%- comment -%} === IMAGE BANNER === {%- endcomment -%}
                            <a class="mega-banner-wrap has-image" href="{{ banner_link }}">
                              <img class="banner-bg-img"
                                   src="{{ block.settings.banner_image | img_url: '1200x' }}"
                                   alt="{{ block.settings.banner_title | default: 'Banner' }}"
                                   loading="lazy">
                              <div class="banner-overlay"></div>
                              <div class="banner-text-block">
                                {%- if block.settings.banner_label != blank -%}
                                  <div class="banner-label">{{ block.settings.banner_label }}</div>
                                {%- endif -%}
                                {%- if block.settings.banner_title != blank -%}
                                  <div class="banner-title">{{ block.settings.banner_title }}</div>
                                {%- endif -%}
                                {%- if block.settings.banner_cta != blank -%}
                                  <span class="banner-cta">{{ block.settings.banner_cta }}</span>
                                {%- endif -%}
                              </div>
                            </a>

                          {%- elsif block.settings.banner_collection != blank -%}
                            {%- comment -%} === COLLECTION FALLBACK BANNER === {%- endcomment -%}
                            {%- assign bcol = collections[block.settings.banner_collection] -%}
                            <a class="mega-banner-wrap no-image" href="{{ bcol.url }}">
                              <div class="banner-text-block">
                                <div class="banner-label">
                                  {%- if block.settings.banner_label != blank -%}
                                    {{ block.settings.banner_label }}
                                  {%- else -%}
                                    Featured Collection
                                  {%- endif -%}
                                </div>
                                <div class="banner-title">
                                  {%- if block.settings.banner_title != blank -%}
                                    {{ block.settings.banner_title }}
                                  {%- else -%}
                                    {{ bcol.title }}
                                  {%- endif -%}
                                </div>
                                {%- if block.settings.banner_cta != blank -%}
                                  <span class="banner-cta">{{ block.settings.banner_cta }}</span>
                                {%- else -%}
                                  <span class="banner-cta">à¤¸à¤­à¥€ à¤¦à¥‡à¤–à¥‡à¤‚ â†’</span>
                                {%- endif -%}
                              </div>
                            </a>

                          {%- elsif block.settings.banner_title != blank -%}
                            {%- comment -%} === TEXT ONLY BANNER (no image, no collection) === {%- endcomment -%}
                            <a class="mega-banner-wrap no-image" href="{{ banner_link }}">
                              <div class="banner-text-block">
                                {%- if block.settings.banner_label != blank -%}
                                  <div class="banner-label">{{ block.settings.banner_label }}</div>
                                {%- endif -%}
                                <div class="banner-title">{{ block.settings.banner_title }}</div>
                                {%- if block.settings.banner_cta != blank -%}
                                  <span class="banner-cta">{{ block.settings.banner_cta }}</span>
                                {%- endif -%}
                              </div>
                            </a>
                          {%- endif -%}

                        {%- endif -%}
                      {%- endif -%}
                    {%- endfor -%}

                    {%- comment -%} --- FEATURED PRODUCTS BLOCK --- {%- endcomment -%}
                    {%- for block in section.blocks -%}
                      {%- if block.type == 'featured_products' -%}
                        {%- assign parent_trimmed    = block.settings.parent_menu_item | strip -%}
                        {%- assign link_title_trimmed = link.title | strip -%}
                        {%- if parent_trimmed == link_title_trimmed -%}

                          <div class="mega-products-grid">

                            {%- comment -%} Product 1 {%- endcomment -%}
                            {%- if block.settings.product_1 != blank -%}
                              {%- assign p = all_products[block.settings.product_1] -%}
                              <div class="mega-product-card">
                                <a href="{{ p.url }}">
                                  {%- if p.featured_image -%}
                                    <img class="mega-product-image"
                                         src="{{ p.featured_image | img_url: '300x' }}"
                                         alt="{{ p.title }}" loading="lazy">
                                  {%- else -%}
                                    <div class="mega-product-placeholder">ðŸŒ¾</div>
                                  {%- endif -%}
                                  <div class="mega-product-title">{{ p.title }}</div>
                                  <div class="mega-product-price">{{ p.price | money }}</div>
                                  <span class="mega-product-btn">View Product</span>
                                </a>
                              </div>
                            {%- endif -%}

                            {%- comment -%} Product 2 {%- endcomment -%}
                            {%- if block.settings.product_2 != blank -%}
                              {%- assign p = all_products[block.settings.product_2] -%}
                              <div class="mega-product-card">
                                <a href="{{ p.url }}">
                                  {%- if p.featured_image -%}
                                    <img class="mega-product-image"
                                         src="{{ p.featured_image | img_url: '300x' }}"
                                         alt="{{ p.title }}" loading="lazy">
                                  {%- else -%}
                                    <div class="mega-product-placeholder">ðŸŒ¾</div>
                                  {%- endif -%}
                                  <div class="mega-product-title">{{ p.title }}</div>
                                  <div class="mega-product-price">{{ p.price | money }}</div>
                                  <span class="mega-product-btn">View Product</span>
                                </a>
                              </div>
                            {%- endif -%}

                            {%- comment -%} Product 3 {%- endcomment -%}
                            {%- if block.settings.product_3 != blank -%}
                              {%- assign p = all_products[block.settings.product_3] -%}
                              <div class="mega-product-card">
                                <a href="{{ p.url }}">
                                  {%- if p.featured_image -%}
                                    <img class="mega-product-image"
                                         src="{{ p.featured_image | img_url: '300x' }}"
                                         alt="{{ p.title }}" loading="lazy">
                                  {%- else -%}
                                    <div class="mega-product-placeholder">ðŸŒ¾</div>
                                  {%- endif -%}
                                  <div class="mega-product-title">{{ p.title }}</div>
                                  <div class="mega-product-price">{{ p.price | money }}</div>
                                  <span class="mega-product-btn">View Product</span>
                                </a>
                              </div>
                            {%- endif -%}

                            {%- comment -%} Product 4 {%- endcomment -%}
                            {%- if block.settings.product_4 != blank -%}
                              {%- assign p = all_products[block.settings.product_4] -%}
                              <div class="mega-product-card">
                                <a href="{{ p.url }}">
                                  {%- if p.featured_image -%}
                                    <img class="mega-product-image"
                                         src="{{ p.featured_image | img_url: '300x' }}"
                                         alt="{{ p.title }}" loading="lazy">
                                  {%- else -%}
                                    <div class="mega-product-placeholder">ðŸŒ¾</div>
                                  {%- endif -%}
                                  <div class="mega-product-title">{{ p.title }}</div>
                                  <div class="mega-product-price">{{ p.price | money }}</div>
                                  <span class="mega-product-btn">View Product</span>
                                </a>
                              </div>
                            {%- endif -%}

                          </div>{%- comment -%} end .mega-products-grid {%- endcomment -%}

                        {%- endif -%}
                      {%- endif -%}
                    {%- endfor -%}

                  </div>{%- comment -%} end .mega-menu-right {%- endcomment -%}

                </div>{%- comment -%} end .mega-menu-content {%- endcomment -%}
              </div>{%- comment -%} end .mega-menu {%- endcomment -%}
            {%- endif -%}
          </li>
        {%- endfor -%}
      </ul>
    </nav>
  </div>
</div>

<script>
function toggleMobileMenu() {
  var menu = document.getElementById('mainMenu');
  menu.classList.toggle('active');
}

function toggleMegaMenuMobile(event) {
  if (window.innerWidth <= 768) {
    var menuItem = event.currentTarget;
    if (menuItem.classList.contains('has-mega-menu')) {
      event.preventDefault();
      menuItem.classList.toggle('mobile-open');
    }
  }
}

document.addEventListener('click', function(event) {
  var menu = document.getElementById('mainMenu');
  var toggle = document.querySelector('.mobile-menu-toggle');
  if (menu && toggle && !menu.contains(event.target) && !toggle.contains(event.target)) {
    menu.classList.remove('active');
  }
});

document.addEventListener('DOMContentLoaded', function() {
  var items = document.querySelectorAll('.has-mega-menu');
  items.forEach(function(item) {
    console.log('Mega menu: ' + item.querySelector('a').textContent.trim());
  });
});
</script>

{% schema %}
{
  "name": "Mega Menu",
  "settings": [
    {
      "type": "link_list",
      "id": "main_menu",
      "label": "Main Menu",
      "default": "main-menu",
      "info": "Select the menu to display"
    },
    {
      "type": "text",
      "id": "mega_menu_items",
      "label": "Menu Items with Mega Menu",
      "info": "Comma separated exact names (e.g., Catalog,Shop)",
      "default": "Catalog"
    },
    {
      "type": "header",
      "content": "Menu Bar Styling"
    },
    {
      "type": "color",
      "id": "menu_bg_color",
      "label": "Menu Background Color",
      "default": "#e31e24"
    },
    {
      "type": "color",
      "id": "menu_text_color",
      "label": "Menu Text Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "menu_hover_bg",
      "label": "Menu Hover Background",
      "default": "#c91a1f"
    },
    {
      "type": "color",
      "id": "menu_hover_color",
      "label": "Menu Hover Text Color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "menu_padding",
      "label": "Menu Item Padding",
      "min": 10,
      "max": 30,
      "step": 2,
      "default": 16,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "menu_font_size",
      "label": "Font Size",
      "min": 12,
      "max": 20,
      "step": 1,
      "default": 14,
      "unit": "px"
    },
    {
      "type": "select",
      "id": "menu_font_weight",
      "label": "Font Weight",
      "options": [
        { "value": "400", "label": "Normal" },
        { "value": "500", "label": "Medium" },
        { "value": "600", "label": "Semi Bold" },
        { "value": "700", "label": "Bold" }
      ],
      "default": "500"
    },
    {
      "type": "select",
      "id": "menu_text_transform",
      "label": "Text Transform",
      "options": [
        { "value": "none",       "label": "None" },
        { "value": "uppercase",  "label": "Uppercase" },
        { "value": "capitalize", "label": "Capitalize" }
      ],
      "default": "none"
    }
  ],
  "blocks": [
    {
      "type": "mega_menu_column",
      "name": "Column (Left Links)",
      "settings": [
        {
          "type": "text",
          "id": "parent_menu_item",
          "label": "Parent Menu Item",
          "info": "Exact top-level menu name (e.g., Catalog)"
        },
        {
          "type": "text",
          "id": "column_heading",
          "label": "Column Heading",
          "default": "Categories"
        },
        {
          "type": "link_list",
          "id": "column_menu",
          "label": "Column Menu",
          "info": "Links auto-split into 2 columns"
        },
        {
          "type": "checkbox",
          "id": "is_featured",
          "label": "Mark as Featured (à¤µà¤¿à¤¶à¥‡à¤· badge)",
          "default": false
        }
      ]
    },
    {
      "type": "menu_banner",
      "name": "Banner (Right Side)",
      "settings": [
        {
          "type": "text",
          "id": "parent_menu_item",
          "label": "Parent Menu Item",
          "info": "Exact top-level menu name (e.g., Catalog)"
        },
        {
          "type": "header",
          "content": "Banner Image"
        },
        {
          "type": "image_picker",
          "id": "banner_image",
          "label": "Upload Banner Image",
          "info": "Recommended: 1200x300px. If empty, collection or text banner will show."
        },
        {
          "type": "header",
          "content": "Banner Text"
        },
        {
          "type": "text",
          "id": "banner_label",
          "label": "Small Label (top)",
          "default": "Featured Collection",
          "info": "Small text above the title (e.g., 'New Arrivals', 'Hot Deals')"
        },
        {
          "type": "text",
          "id": "banner_title",
          "label": "Banner Title",
          "default": "Explore Our Range",
          "info": "Main heading on the banner"
        },
        {
          "type": "text",
          "id": "banner_cta",
          "label": "Button Text",
          "default": "à¤¸à¤­à¥€ à¤¦à¥‡à¤–à¥‡à¤‚ â†’",
          "info": "Call-to-action button label"
        },
        {
          "type": "header",
          "content": "Banner Link"
        },
        {
          "type": "url",
          "id": "banner_link",
          "label": "Banner Link URL",
          "info": "Where should clicking the banner go?"
        },
        {
          "type": "header",
          "content": "Fallback (if no image uploaded)"
        },
        {
          "type": "collection",
          "id": "banner_collection",
          "label": "Collection (fallback)",
          "info": "If no image uploaded, banner links to this collection"
        }
      ]
    },
    {
      "type": "featured_products",
      "name": "Products (Right Side)",
      "settings": [
        {
          "type": "text",
          "id": "parent_menu_item",
          "label": "Parent Menu Item",
          "info": "Exact top-level menu name (e.g., Catalog)"
        },
        {
          "type": "product",
          "id": "product_1",
          "label": "Product 1"
        },
        {
          "type": "product",
          "id": "product_2",
          "label": "Product 2"
        },
        {
          "type": "product",
          "id": "product_3",
          "label": "Product 3"
        },
        {
          "type": "product",
          "id": "product_4",
          "label": "Product 4"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Mega Menu"
    }
  ]
}
{% endschema %}
