{% assign custom_review_section = section.id | replace: '_', '' | downcase %}

{% style %}
  .reviews-carousel-{{ custom_review_section }} {
    display: block;
    width: {{ section.settings.desktop_width_percent }}%;
    max-width: 100%;
    background-color: {{ section.settings.background_color }};
    padding: 60px 20px;
    position: relative;
    overflow: hidden;
  }

  .reviews-carousel__decorative-leaf-{{ custom_review_section }} {
    position: absolute;
    width: 150px;
    height: 150px;
    pointer-events: none;
  }

  .reviews-carousel__decorative-leaf-{{ custom_review_section }}--top-left {
    top: 0;
    left: 0;
  }

  .reviews-carousel__decorative-leaf-{{ custom_review_section }}--top-right {
    top: 0;
    right: 0;
    transform: scaleX(-1);
  }

  .reviews-carousel__container-{{ custom_review_section }} {
    max-width: 1450px;
    margin: 0 auto;
    position: relative;
  }

  .reviews-carousel__header-{{ custom_review_section }} {
    text-align: center;
    margin-bottom: 50px;
  }

  .reviews-carousel__heading-{{ custom_review_section }} {
    font-size: {{ section.settings.heading_size }}px;
    font-weight: 700;
    color: {{ section.settings.heading_color }};
    margin: 0 0 20px;
  }

  .reviews-carousel__subheading-{{ custom_review_section }} {
    font-size: {{ section.settings.subheading_size }}px;
    color: {{ section.settings.subheading_color }};
    line-height: 1.6;
    max-width: 800px;
    margin: 0 auto;
  }

  .reviews-carousel__slider-wrapper-{{ custom_review_section }} {
    position: relative;
    padding: 0 60px;
  }

  .reviews-carousel__slider-{{ custom_review_section }} {
    overflow: hidden;
    position: relative;
  }

  .reviews-carousel__track-{{ custom_review_section }} {
    display: flex;
    transition: transform 0.5s ease;
    gap: {{ section.settings.card_gap }}px;
  }

  .reviews-carousel__card-{{ custom_review_section }} {
    flex: 0 0 calc((100% - ({{ section.settings.card_gap }}px * 2)) / 3);
    background-color: {{ section.settings.card_background }};
    border-radius: {{ section.settings.card_border_radius }}px;
    padding: {{ section.settings.card_padding }}px;
    display: flex;
    flex-direction: column;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .reviews-carousel__card-{{ custom_review_section }}:hover {
    transform: translateY(-5px);
  }

  .reviews-carousel__review-text-{{ custom_review_section }} {
    font-size: {{ section.settings.review_text_size }}px;
    color: {{ section.settings.review_text_color }};
    line-height: 1.6;
    margin-bottom: 20px;
    flex-grow: 1;
    text-align: center;
    
  }

  .reviews-carousel__product-section-{{ custom_review_section }} {
    display: flex;
    align-items: center;
    gap: 15px;

    margin-bottom: 15px;
    background: #fff;
    border-radius: 20px;
    padding: 10px;
  }

  .reviews-carousel__product-image-{{ custom_review_section }} {
    width: 60px;
    height: 60px;
    flex-shrink: 0;
    border-radius: 8px;
    overflow: hidden;
  }

  .reviews-carousel__product-image-{{ custom_review_section }} img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .reviews-carousel__product-info-{{ custom_review_section }} {
    flex-grow: 1;
  }

  .reviews-carousel__product-name-{{ custom_review_section }} {
    font-size: 14px;
    font-weight: 600;
    color: #000000;
    margin: 0 0 5px;
  }

  .reviews-carousel__product-price-wrapper-{{ custom_review_section }} {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .reviews-carousel__product-price-{{ custom_review_section }} {
    font-size: 12px;
    font-weight: 600;
    color: {{ section.settings.price_color }};
  }

  .reviews-carousel__discount-badge-{{ custom_review_section }} {
    background-color: {{ section.settings.discount_badge_bg }};
    color: {{ section.settings.discount_badge_text }};
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 600;
  }

  .reviews-carousel__customer-info-{{ custom_review_section }} {
    text-align: center;
  }

  .reviews-carousel__customer-name-{{ custom_review_section }} {
    font-size: 18px;
    font-weight: 700;
    color: #000000;
    margin: 0 0 5px;
  }

  .reviews-carousel__customer-location-{{ custom_review_section }} {
    font-size: 14px;
    color: {{ section.settings.location_color }};
    margin: 0;
  }

  .reviews-carousel__nav-button-{{ custom_review_section }} {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background-color: {{ section.settings.nav_button_bg }};
    color: {{ section.settings.nav_button_color }};
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
    transition: background-color 0.3s ease;
  }

  .reviews-carousel__nav-button-{{ custom_review_section }}:hover {
    background-color: {{ section.settings.nav_button_hover_bg }};
  }

  .reviews-carousel__nav-button-{{ custom_review_section }}--prev {
    left: 0;
  }

  .reviews-carousel__nav-button-{{ custom_review_section }}--next {
    right: 0;
  }

  .reviews-carousel__nav-button-{{ custom_review_section }} svg {
    width: 24px;
    height: 24px;
    color: #000;
  }

  @media screen and (max-width: 1199px) {
    .reviews-carousel__card-{{ custom_review_section }} {
      flex: 0 0 calc((100% - {{ section.settings.card_gap }}px) / 2);
    }
  }

  @media screen and (max-width: 767px) {
    .reviews-carousel__card-{{ custom_review_section }} {
      flex: 0 0 100%;
    }


    .reviews-carousel__review-text-{{ custom_review_section }} { font-size: 12px; }

    .reviews-carousel__slider-wrapper-{{ custom_review_section }} {
      padding: 0 50px;
    }

    .reviews-carousel__heading-{{ custom_review_section }} {
      font-size: {{ section.settings.heading_size | times: 0.7 }}px;
    }
    .reviews-carousel__card-{{ custom_review_section }} { padding: 15px; }

    .reviews-carousel__subheading-{{ custom_review_section }} {
      font-size: {{ section.settings.subheading_size | times: 0.9 }}px;
    }

    .reviews-carousel__nav-button-{{ custom_review_section }} {
      width: 40px;
      height: 40px;
    }
    
  .reviews-carousel__product-name-{{ custom_review_section }} {
    font-size: 12px;
  
  }


    .reviews-carousel__product-price-{{ custom_review_section }} {
    font-size: 10px;
 
  }

  .reviews-carousel__discount-badge-{{ custom_review_section }} {
  
    font-size: 10px;
  }
  .reviews-carousel__product-section-{{ custom_review_section }} { border-radius: 10px; }
  }
{% endstyle %}

<customer-reviews-carousel-{{ custom_review_section }}
  class="reviews-carousel-{{ custom_review_section }}"
  data-autoplay="{{ section.settings.autoplay }}"
  data-autoplay-speed="{{ section.settings.autoplay_speed }}"
  {{ section.shopify_attributes }}
>
  <div class="reviews-carousel__decorative-leaf-{{ custom_review_section }} reviews-carousel__decorative-leaf-{{ custom_review_section }}--top-left">
    <img src="https://cdn.shopify.com/s/files/1/0975/8136/7585/files/4_2.png?v=1771748103" width="" height="">
  </div>

  <div class="reviews-carousel__decorative-leaf-{{ custom_review_section }} reviews-carousel__decorative-leaf-{{ custom_review_section }}--top-right">
    <img src="https://cdn.shopify.com/s/files/1/0975/8136/7585/files/4_1.png?v=1771748105" width="" height="">
  </div>

  <div class="reviews-carousel__container-{{ custom_review_section }}">
    <div class="reviews-carousel__header-{{ custom_review_section }}">
      <h2 class="reviews-carousel__heading-{{ custom_review_section }}">{{ section.settings.heading }}</h2>
      <p class="reviews-carousel__subheading-{{ custom_review_section }}">{{ section.settings.subheading }}</p>
    </div>

    <div class="reviews-carousel__slider-wrapper-{{ custom_review_section }}">
      <button
        class="reviews-carousel__nav-button-{{ custom_review_section }} reviews-carousel__nav-button-{{ custom_review_section }}--prev"
        aria-label="Previous review"
      >
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </button>

      <div class="reviews-carousel__slider-{{ custom_review_section }}">
  <div class="reviews-carousel__track-{{ custom_review_section }}">

    {% for block in section.blocks %}
      {% assign product = block.settings.product %}

      {% if block.settings.review_text != blank or block.settings.customer_name != blank %}
        <div class="reviews-carousel__card-{{ custom_review_section }}" {{ block.shopify_attributes }}>

          <div class="reviews-carousel__review-text-{{ custom_review_section }}">
            {{ block.settings.review_text }}
          </div>

          <div class="reviews-carousel__product-section-{{ custom_review_section }}">
            
            <div class="reviews-carousel__product-image-{{ custom_review_section }}">
              {% if block.settings.product_image %}
                <img
                  src="{{ block.settings.product_image | image_url: width: 120 }}"
                  alt="{{ block.settings.product_name | escape }}"
                  loading="lazy"
                  width="60"
                  height="60"
                >
              {% elsif product and product.featured_image %}
                <img
                  src="{{ product.featured_image | image_url: width: 120 }}"
                  alt="{{ product.title | escape }}"
                  loading="lazy"
                  width="60"
                  height="60"
                >
              {% else %}
                <div style="width:100%;height:100%;background:#f4f4f4;display:flex;align-items:center;justify-content:center;">
                  <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="#cccccc" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                    <polyline points="21 15 16 10 5 21"></polyline>
                  </svg>
                </div>
              {% endif %}
            </div>

            <div class="reviews-carousel__product-info-{{ custom_review_section }}">
              
              <h3 class="reviews-carousel__product-name-{{ custom_review_section }}">
                {% if product %}
                  {{ product.title }}
                {% else %}
                  {{ block.settings.product_name }}
                {% endif %}
              </h3>

              <div class="reviews-carousel__product-price-wrapper-{{ custom_review_section }}">
                <span class="reviews-carousel__product-price-{{ custom_review_section }}">
                  {% if product %}
                    {{ product.price | money }}
                  {% else %}
                    {{ block.settings.product_price }}
                  {% endif %}
                </span>

                {% if block.settings.discount != blank %}
                  <span class="reviews-carousel__discount-badge-{{ custom_review_section }}">
                    {{ block.settings.discount }}
                  </span>
                {% endif %}
              </div>

            </div>
          </div>

          <div class="reviews-carousel__customer-info-{{ custom_review_section }}">
            <p class="reviews-carousel__customer-name-{{ custom_review_section }}">
              {{ block.settings.customer_name }}
            </p>
            <p class="reviews-carousel__customer-location-{{ custom_review_section }}">
              {{ block.settings.customer_location }}
            </p>
          </div>

        </div>
      {% endif %}
    {% endfor %}

  </div>
</div>

      <button
        class="reviews-carousel__nav-button-{{ custom_review_section }} reviews-carousel__nav-button-{{ custom_review_section }}--next"
        aria-label="Next review"
      >
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </button>
    </div>
  </div>
</customer-reviews-carousel-{{ custom_review_section }}>

<script>
  (function() {
    class CustomerReviewsCarousel extends HTMLElement {
      constructor() {
        super();
        this.currentIndex = 0;
        this.autoplayInterval = null;
      }

      connectedCallback() {
        this.track = this.querySelector('.reviews-carousel__track-{{ custom_review_section }}');
        this.cards = this.querySelectorAll('.reviews-carousel__card-{{ custom_review_section }}');
        this.prevButton = this.querySelector('.reviews-carousel__nav-button-{{ custom_review_section }}--prev');
        this.nextButton = this.querySelector('.reviews-carousel__nav-button-{{ custom_review_section }}--next');
        this.autoplay = this.dataset.autoplay === 'true';
        this.autoplaySpeed = parseInt(this.dataset.autoplaySpeed) * 1000;

        this.setupEventListeners();
        this.updateCarousel();

        if (this.autoplay) {
          this.startAutoplay();
        }

        window.addEventListener('resize', () => this.updateCarousel());
      }

      setupEventListeners() {
        this.prevButton.addEventListener('click', () => {
          this.navigate(-1);
          if (this.autoplay) {
            this.resetAutoplay();
          }
        });

        this.nextButton.addEventListener('click', () => {
          this.navigate(1);
          if (this.autoplay) {
            this.resetAutoplay();
          }
        });
      }

      navigate(direction) {
        const totalCards = this.cards.length;
        const cardsPerView = this.getCardsPerView();
        const maxIndex = Math.max(0, totalCards - cardsPerView);

        this.currentIndex += direction;

        if (this.currentIndex < 0) {
          this.currentIndex = maxIndex;
        } else if (this.currentIndex > maxIndex) {
          this.currentIndex = 0;
        }

        this.updateCarousel();
      }

      getCardsPerView() {
        const width = window.innerWidth;
        if (width < 768) return 1;
        if (width < 1200) return 2;
        return 3;
      }

      updateCarousel() {
        if (this.cards.length === 0) return;
        const cardWidth = this.cards[0].offsetWidth;
        const gap = parseInt(getComputedStyle(this.track).gap) || 0;
        const offset = this.currentIndex * (cardWidth + gap);
        this.track.style.transform = 'translateX(-' + offset + 'px)';
      }

      startAutoplay() {
        this.autoplayInterval = setInterval(() => {
          this.navigate(1);
        }, this.autoplaySpeed);
      }

      resetAutoplay() {
        clearInterval(this.autoplayInterval);
        this.startAutoplay();
      }

      disconnectedCallback() {
        if (this.autoplayInterval) {
          clearInterval(this.autoplayInterval);
        }
      }
    }

    customElements.define('customer-reviews-carousel-{{ custom_review_section }}', CustomerReviewsCarousel);
  })();
</script>

{% schema %}
{
  "name": "Customer reviews carousel",
  "settings": [
    {
      "type": "header",
      "content": "Header"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Customer Reviews By Products"
    },
    {
      "type": "range",
      "id": "heading_size",
      "label": "Heading size",
      "min": 20,
      "max": 60,
      "step": 2,
      "unit": "px",
      "default": 36
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading color",
      "default": "#000000"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Subheading",
      "default": "Join thousands of farmers who trust us for their agricultural needs. With a focus on quality, innovation, and customer satisfaction, we are committed to helping you succeed."
    },
    {
      "type": "range",
      "id": "subheading_size",
      "label": "Subheading size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 16
    },
    {
      "type": "color",
      "id": "subheading_color",
      "label": "Subheading color",
      "default": "#666666"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "desktop_width_percent",
      "label": "Desktop width",
      "min": 50,
      "max": 100,
      "step": 5,
      "unit": "%",
      "default": 100
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#f9f9f9"
    },
    {
      "type": "color",
      "id": "leaf_color",
      "label": "Decorative leaf color",
      "default": "#4CAF50"
    },
    {
      "type": "header",
      "content": "Card style"
    },
    {
      "type": "color",
      "id": "card_background",
      "label": "Card background",
      "default": "#F5F5F5"
    },
    {
      "type": "range",
      "id": "card_padding",
      "label": "Card padding",
      "min": 20,
      "max": 60,
      "step": 5,
      "unit": "px",
      "default": 30
    },
    {
      "type": "range",
      "id": "card_border_radius",
      "label": "Card border radius",
      "min": 0,
      "max": 30,
      "step": 2,
      "unit": "px",
      "default": 10
    },
    {
      "type": "text",
      "id": "card_shadow",
      "label": "Card shadow",
      "default": "0 2px 8px rgba(0, 0, 0, 0.1)"
    },
    {
      "type": "range",
      "id": "card_gap",
      "label": "Gap between cards",
      "min": 10,
      "max": 50,
      "step": 5,
      "unit": "px",
      "default": 25
    },
    {
      "type": "header",
      "content": "Review text"
    },
    {
      "type": "range",
      "id": "review_text_size",
      "label": "Text size",
      "min": 12,
      "max": 25,
      "step": 1,
      "unit": "px",
      "default": 21
    },
    {
      "type": "color",
      "id": "review_text_color",
      "label": "Text color",
      "default": "#000"
    },
    {
      "type": "header",
      "content": "Product info"
    },
    {
      "type": "color",
      "id": "price_color",
      "label": "Price color",
      "default": "#2d7a4f"
    },
    {
      "type": "color",
      "id": "discount_badge_bg",
      "label": "Discount badge background",
      "default": "#e74c3c"
    },
    {
      "type": "color",
      "id": "discount_badge_text",
      "label": "Discount badge text",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "location_color",
      "label": "Location color",
      "default": "#888888"
    },
    {
      "type": "header",
      "content": "Navigation"
    },
    {
      "type": "color",
      "id": "nav_button_bg",
      "label": "Button background",
      "default": "#FFF"
    },
    {
      "type": "color",
      "id": "nav_button_color",
      "label": "Button icon color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "nav_button_hover_bg",
      "label": "Button hover background",
      "default": "#333333"
    },
    {
      "type": "header",
      "content": "Carousel settings"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Enable autoplay",
      "default": false
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "label": "Autoplay speed",
      "min": 3,
      "max": 10,
      "step": 1,
      "unit": "s",
      "default": 5
    },
   
  ],

  "blocks": [
{
  "type": "review_item",
  "name": "Review Item",
  "settings": [
    {
      "type": "textarea",
      "id": "review_text",
      "label": "Review Text"
    },
    {
      "type": "product",
      "id": "product",
      "label": "Select Product"
    },
    {
      "type": "text",
      "id": "product_name",
      "label": "Custom Product Name"
    },
    {
      "type": "text",
      "id": "product_price",
      "label": "Custom Product Price"
    },
    {
      "type": "text",
      "id": "discount",
      "label": "Discount Badge (Optional)"
    },
    {
      "type": "image_picker",
      "id": "product_image",
      "label": "Custom Product Image"
    },
    {
      "type": "text",
      "id": "customer_name",
      "label": "Customer Name"
    },
    {
      "type": "text",
      "id": "customer_location",
      "label": "Customer Location"
    }
  ]
}

  ],
  "presets": [
    {
      "name": "Customer reviews carousel"
    }
  ]
}
{% endschema %}
