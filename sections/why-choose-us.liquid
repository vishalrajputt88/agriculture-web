{% assign custom_why_choose = section.id | replace: '_', '' | downcase %}

{% style %}
  .video-section-{{ custom_why_choose }} {
    display: block;
    width: 100%;
    background-color: {{ section.settings.background_color }};
    padding: {{ section.settings.padding_desktop }}px 0;
  }

  @media screen and (max-width: 749px) {
    .video-section-{{ custom_why_choose }} {
      padding: {{ section.settings.padding_mobile }}px 0;
    }
  }

  .video-container-{{ custom_why_choose }} {
    max-width: 1100px;
    margin: 0 auto;
    padding: 0 20px;
  }

  .video-player-wrapper-{{ custom_why_choose }} {
    position: relative;
    width: 100%;
    border-radius: {{ section.settings.border_radius }}px;
    overflow: hidden;
    background-color: #1a1a1a;
    aspect-ratio: 16 / 9;
  }

  .video-player-wrapper-{{ custom_why_choose }} video {
    display: none;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .video-player-wrapper-{{ custom_why_choose }}.is-playing video {
    display: block;
  }

  .video-thumbnail-wrapper-{{ custom_why_choose }} {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    cursor: pointer;
    background-color: #1a1a1a;
  }

  .video-player-wrapper-{{ custom_why_choose }}.is-playing .video-thumbnail-wrapper-{{ custom_why_choose }} {
    display: none;
  }

  .video-thumbnail-img-{{ custom_why_choose }} {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .video-thumbnail-placeholder-{{ custom_why_choose }} {
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .video-thumbnail-placeholder-{{ custom_why_choose }} svg {
    width: 100px;
    height: 100px;
    opacity: 0.3;
    fill: #ffffff;
  }

  .video-overlay-content-{{ custom_why_choose }} {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 2;
    pointer-events: none;
  }

  .video-overlay-text-{{ custom_why_choose }} {
    text-align: center;
    color: #ffffff;
    margin-bottom: 24px;
    padding: 0 20px;
    max-width: 800px;
  }

  .video-overlay-heading-{{ custom_why_choose }} {
    font-size: 36px;
    font-weight: 700;
    margin: 0 0 12px 0;
    text-shadow: 0 2px 12px rgba(0, 0, 0, 0.6);
    line-height: 1.2;
  }

  .video-overlay-subheading-{{ custom_why_choose }} {
    font-size: 18px;
    margin: 0;
    text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
    line-height: 1.4;
  }

  @media screen and (max-width: 749px) {
    .video-overlay-heading-{{ custom_why_choose }} {
      font-size: 24px;
    }

    .video-overlay-subheading-{{ custom_why_choose }} {
      font-size: 16px;
    }
  }

  .video-play-btn-{{ custom_why_choose }} {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background-color: rgba(255, 255, 255, 0.95);
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    pointer-events: auto;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  }

  .video-play-btn-{{ custom_why_choose }}:hover {
    transform: scale(1.1);
    background-color: #ffffff;
    box-shadow: 0 6px 24px rgba(0, 0, 0, 0.4);
  }

  .video-play-icon-{{ custom_why_choose }} {
    width: 0;
    height: 0;
    border-left: 26px solid #000000;
    border-top: 16px solid transparent;
    border-bottom: 16px solid transparent;
    margin-left: 6px;
  }

  .video-duration-badge-{{ custom_why_choose }} {
    position: absolute;
    bottom: 16px;
    right: 16px;
    background-color: rgba(0, 0, 0, 0.85);
    color: #ffffff;
    padding: 6px 12px;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 600;
    z-index: 2;
    letter-spacing: 0.5px;
  }

  .video-content-section-{{ custom_why_choose }} {
    max-width: 900px;
    margin: 60px auto 0;
    text-align: center;
    padding: 0 20px;
  }

  @media screen and (max-width: 749px) {
    .video-content-section-{{ custom_why_choose }} {
      margin-top: 40px;
    }
  }

  .video-content-heading-{{ custom_why_choose }} {
    font-size: 40px;
    font-weight: 700;
    color: {{ section.settings.heading_color }};
    margin: 0 0 20px 0;
    line-height: 1.2;
  }

  @media screen and (max-width: 749px) {
    .video-content-heading-{{ custom_why_choose }} {
      font-size: 28px;
    }
  }

  .video-content-description-{{ custom_why_choose }} {
    max-width: 750px;
    margin: 0 auto;
    color: {{ section.settings.paragraph_color }};
    font-size: 16px;
    line-height: 1.7;
  }

  .video-content-description-{{ custom_why_choose }} p {
    margin: 0 0 16px 0;
  }

  .video-content-description-{{ custom_why_choose }} p:last-child {
    margin-bottom: 0;
  }
{% endstyle %}

<video-player-{{ custom_why_choose }} class="video-section-{{ custom_why_choose }}" {{ section.shopify_attributes }}>
  <div class="video-container-{{ custom_why_choose }}">
    <div class="video-player-wrapper-{{ custom_why_choose }}" data-video-wrapper>
      {% if section.settings.video %}
        {{
          section.settings.video
          | video_tag:
            autoplay: false,
            controls: true,
            loop: false,
            muted: false,
            preload: 'none'
        }}
      {% endif %}

      <div class="video-thumbnail-wrapper-{{ custom_why_choose }}" data-thumbnail>
        {% if section.settings.video.preview_image %}
          <img
            src="{{ section.settings.video.preview_image | image_url: width: 2200 }}"
            srcset="{{ section.settings.video.preview_image | image_url: width: 550 }} 550w,
                    {{ section.settings.video.preview_image | image_url: width: 1100 }} 1100w,
                    {{ section.settings.video.preview_image | image_url: width: 2200 }} 2200w"
            sizes="(min-width: 1100px) 1100px, 100vw"
            alt="{{ section.settings.video.alt | default: 'Video preview' }}"
            class="video-thumbnail-img-{{ custom_why_choose }}"
            width="1100"
            height="619"
            loading="eager"
          >
        {% elsif section.settings.custom_thumbnail %}
          <img
            src="{{ section.settings.custom_thumbnail | image_url: width: 2200 }}"
            srcset="{{ section.settings.custom_thumbnail | image_url: width: 550 }} 550w,
                    {{ section.settings.custom_thumbnail | image_url: width: 1100 }} 1100w,
                    {{ section.settings.custom_thumbnail | image_url: width: 2200 }} 2200w"
            sizes="(min-width: 1100px) 1100px, 100vw"
            alt="{{ section.settings.custom_thumbnail.alt | default: 'Video thumbnail' }}"
            class="video-thumbnail-img-{{ custom_why_choose }}"
            width="1100"
            height="619"
            loading="eager"
          >
        {% else %}
          <div class="video-thumbnail-placeholder-{{ custom_why_choose }}">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path d="M8 5v14l11-7z"/>
            </svg>
          </div>
        {% endif %}

        <div class="video-overlay-content-{{ custom_why_choose }}">
          {% if section.settings.overlay_heading != blank or section.settings.overlay_subheading != blank %}
            <div class="video-overlay-text-{{ custom_why_choose }}">
              {% if section.settings.overlay_heading != blank %}
                <h3 class="video-overlay-heading-{{ custom_why_choose }}">{{ section.settings.overlay_heading }}</h3>
              {% endif %}
              {% if section.settings.overlay_subheading != blank %}
                <p class="video-overlay-subheading-{{ custom_why_choose }}">{{ section.settings.overlay_subheading }}</p>
              {% endif %}
            </div>
          {% endif %}

          <button class="video-play-btn-{{ custom_why_choose }}" aria-label="Play video" data-play-btn>
            <div class="video-play-icon-{{ custom_why_choose }}"></div>
          </button>
        </div>

        {% if section.settings.video_duration != blank %}
          <div class="video-duration-badge-{{ custom_why_choose }}">{{ section.settings.video_duration }}</div>
        {% endif %}
      </div>
    </div>

    {% if section.settings.below_heading != blank or section.settings.below_description != blank %}
      <div class="video-content-section-{{ custom_why_choose }}">
        {% if section.settings.below_heading != blank %}
          <h2 class="video-content-heading-{{ custom_why_choose }}">{{ section.settings.below_heading }}</h2>
        {% endif %}
        {% if section.settings.below_description != blank %}
          <div class="video-content-description-{{ custom_why_choose }}">{{ section.settings.below_description }}</div>
        {% endif %}
      </div>
    {% endif %}
  </div>
</video-player-{{ custom_why_choose }}>

<script>
  (function() {
    class VideoPlayer extends HTMLElement {
      constructor() {
        super();
        this.hasPlayed = false;
      }

      connectedCallback() {
        this.wrapper = this.querySelector('[data-video-wrapper]');
        this.playBtn = this.querySelector('[data-play-btn]');
        this.thumbnail = this.querySelector('[data-thumbnail]');
        this.video = this.querySelector('video');

        if (!this.playBtn || !this.wrapper) {
          return;
        }

        this.playBtn.addEventListener('click', this.playVideo.bind(this));
        
        if (this.thumbnail) {
          this.thumbnail.addEventListener('click', this.playVideo.bind(this));
        }
      }

      playVideo(event) {
        if (event) {
          event.preventDefault();
          event.stopPropagation();
        }

        if (this.hasPlayed || !this.video || !this.wrapper) {
          return;
        }

        this.hasPlayed = true;
        this.wrapper.classList.add('is-playing');

        this.video.play().catch(function(error) {
          console.error('Video playback failed:', error);
        });
      }
    }

    customElements.define('video-player-{{ custom_why_choose }}', VideoPlayer);
  })();
</script>

{% schema %}
{
  "name": "Video section",
  "settings": [
    {
      "type": "header",
      "content": "Video"
    },
    {
      "type": "video",
      "id": "video",
      "label": "Video file"
    },
    {
      "type": "image_picker",
      "id": "custom_thumbnail",
      "label": "Custom thumbnail",
      "info": "Used only if video has no preview image"
    },
    {
      "type": "text",
      "id": "video_duration",
      "label": "Duration",
      "placeholder": "2:30"
    },
    {
      "type": "text",
      "id": "overlay_heading",
      "label": "Overlay heading",
      "placeholder": "Watch our story"
    },
    {
      "type": "text",
      "id": "overlay_subheading",
      "label": "Overlay subheading",
      "placeholder": "Discover what makes us different"
    },
    {
      "type": "header",
      "content": "Content below video"
    },
    {
      "type": "text",
      "id": "below_heading",
      "label": "Heading",
      "default": "Watch our story"
    },
    {
      "type": "richtext",
      "id": "below_description",
      "label": "Description",
      "default": "<p>Discover how we're making a difference in the world. Our journey is one of passion, dedication, and commitment to excellence.</p>"
    },
    {
      "type": "header",
      "content": "Style"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "paragraph_color",
      "label": "Paragraph color",
      "default": "#cccccc"
    },
    {
      "type": "range",
      "id": "border_radius",
      "label": "Video border radius",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "default": 16
    },
    {
      "type": "range",
      "id": "padding_desktop",
      "label": "Desktop padding",
      "min": 0,
      "max": 120,
      "step": 10,
      "unit": "px",
      "default": 80
    },
    {
      "type": "range",
      "id": "padding_mobile",
      "label": "Mobile padding",
      "min": 0,
      "max": 100,
      "step": 10,
      "unit": "px",
      "default": 50
    }
  ],
  "presets": [
    {
      "name": "Video section"
    }
  ]
}
{% endschema %}
